# Marketplace Entities

type Seller @entity {
  id: ID! # sellerId
  owner: Bytes!
  geohash: Bytes!
  geohashPrefix: String! # First 4 chars for filtering
  storefrontIpfs: String!
  offersDelivery: Boolean!
  offersPickup: Boolean!
  deliveryRadiusKm: BigInt!
  createdAt: BigInt!
  active: Boolean!
  listings: [Listing!]! @derivedFrom(field: "seller")
  orders: [Order!]! @derivedFrom(field: "seller")
  ambassador: Ambassador
  totalSales: BigInt!
  totalOrders: BigInt!
}

type Listing @entity {
  id: ID! # listingId
  seller: Seller!
  metadataIpfs: String!
  pricePerUnit: BigInt!
  quantityAvailable: BigInt!
  active: Boolean!
  orders: [Order!]! @derivedFrom(field: "listing")
  totalSold: BigInt!
}

type Order @entity {
  id: ID! # orderId
  listing: Listing!
  seller: Seller!
  buyer: Bytes!
  quantity: BigInt!
  totalPrice: BigInt!
  isDelivery: Boolean!
  status: OrderStatus!
  createdAt: BigInt!
  completedAt: BigInt
  disputedAt: BigInt
}

enum OrderStatus {
  Pending
  Accepted
  ReadyForPickup
  OutForDelivery
  Completed
  Disputed
  Refunded
  Cancelled
}

# Ambassador Entities

type Ambassador @entity {
  id: ID! # ambassadorId
  wallet: Bytes!
  seniorAmbassador: Ambassador
  juniorAmbassadors: [Ambassador!]! @derivedFrom(field: "seniorAmbassador")
  totalEarned: BigInt!
  recruitedSellers: [Seller!]! @derivedFrom(field: "ambassador")
  recruitedSellersCount: BigInt!
  recruitedAmbassadorsCount: BigInt!
  createdAt: BigInt!
  active: Boolean!
  rewards: [AmbassadorReward!]! @derivedFrom(field: "ambassador")
}

type AmbassadorReward @entity {
  id: ID! # txHash-logIndex
  ambassador: Ambassador!
  seller: Seller!
  amount: BigInt!
  seniorAmount: BigInt!
  timestamp: BigInt!
  txHash: Bytes!
}

# Token Entities

type TokenHolder @entity {
  id: ID! # address
  balance: BigInt!
  totalReceived: BigInt!
  totalSent: BigInt!
  transferCount: BigInt!
}

type Transfer @entity {
  id: ID! # txHash-logIndex
  from: Bytes!
  to: Bytes!
  amount: BigInt!
  timestamp: BigInt!
  txHash: Bytes!
  blockNumber: BigInt!
}

# Aggregated Stats

type MarketplaceStats @entity {
  id: ID! # "global"
  totalSellers: BigInt!
  totalListings: BigInt!
  totalOrders: BigInt!
  totalVolume: BigInt!
  totalAmbassadors: BigInt!
  totalAmbassadorRewards: BigInt!
}

# ============ Phase 1 Seeds Entities ============

type GlobalSeedsStats @entity {
  id: ID! # "global"
  totalSeeds: BigInt!
  totalSeedsFromPurchases: BigInt!
  totalSeedsFromSales: BigInt!
  totalSeedsFromReferrals: BigInt!
  totalSeedsFromMilestones: BigInt!
  totalSeedsFromRecruitments: BigInt!
  uniqueEarners: BigInt!
  phase1StartTimestamp: BigInt!
}

type SeedsBalance @entity {
  id: ID! # user address (lowercase)
  user: Bytes!
  purchases: BigInt! # Seeds from buying
  sales: BigInt! # Seeds from selling
  referrals: BigInt! # Seeds from ambassador commissions
  milestones: BigInt! # Seeds from seller milestones
  recruitments: BigInt! # Seeds from recruiting activated sellers
  total: BigInt! # Sum of all Seeds
  lastUpdated: BigInt!
  eventCount: BigInt!
}

type SeedsEvent @entity {
  id: ID! # txHash-logIndex
  user: Bytes!
  amount: BigInt!
  adjustedAmount: BigInt! # After early adopter multiplier applied
  reason: String! # "purchase", "sale", "referral", "milestone", "recruitment"
  orderId: BigInt
  sellerId: BigInt
  ambassadorId: BigInt
  milestone: String # For milestone events
  chainLevel: BigInt # For ambassador chain rewards
  multiplier: Int! # 200 = 2x, 150 = 1.5x, 100 = 1x
  timestamp: BigInt!
  txHash: Bytes!
  blockNumber: BigInt!
}

type SeedsLeaderboard @entity {
  id: ID! # "leaderboard"
  topEarners: [SeedsBalance!]!
  lastUpdated: BigInt!
}
